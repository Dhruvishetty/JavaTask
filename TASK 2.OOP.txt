package examlogger;

public class StudentInfo {
    private String studentName;
    private int regNo;
    private int score;

    public StudentInfo(String studentName, int regNo, int score) {
        this.studentName = studentName;
        this.regNo = regNo;
        this.score = score;
    }

    public String details() {
        return studentName + "," + regNo + "," + score;
    }
}
package examlogger;

import java.io.FileWriter;
import java.io.IOException;
import java.util.concurrent.locks.ReentrantLock;

// Handles synchronized writing using Lock instead of synchronized keyword
public class SafeFileWriter {
    private final String path;
    private final ReentrantLock lock = new ReentrantLock();

    public SafeFileWriter(String path) {
        this.path = path;
    }

    public void record(StudentInfo student) {
        lock.lock();
        try (FileWriter writer = new FileWriter(path, true)) {
            writer.write(student.details() + System.lineSeparator());
            System.out.println("Score recorded for: " + student.details());
        } catch (IOException e) {
            System.out.println("File write failed: " + e.getMessage());
        } finally {
            lock.unlock();
        }
    }
}
package examlogger;

public class ScoreEntryThread extends Thread {
    private final SafeFileWriter fileWriter;
    private final StudentInfo student;

    public ScoreEntryThread(SafeFileWriter fileWriter, StudentInfo student) {
        this.fileWriter = fileWriter;
        this.student = student;
    }

    public void run() {
        fileWriter.record(student);
    }
}
package examlogger;

public class MainApp {
    public static void main(String[] args) {
        String file = "exam_scores.csv";
        SafeFileWriter writer = new SafeFileWriter(file);

        StudentInfo s1 = new StudentInfo("Neha", 401, 92);
        StudentInfo s2 = new StudentInfo("Vikram", 402, 86);
        StudentInfo s3 = new StudentInfo("Priya", 403, 78);

        Thread t1 = new ScoreEntryThread(writer, s1);
        Thread t2 = new ScoreEntryThread(writer, s2);
        Thread t3 = new ScoreEntryThread(writer, s3);

        // Run threads with staggered delays to simulate real submissions
        t1.start();
        try { Thread.sleep(30); } catch (InterruptedException e) {}
        t2.start();
        try { Thread.sleep(30); } catch (InterruptedException e) {}
        t3.start();

        try {
            t1.join();
            t2.join();
            t3.join();
        } catch (InterruptedException e) {
            System.out.println("Thread interrupted.");
        }

        System.out.println("All student scores successfully saved!");
    }
}
package examlogger;

import org.junit.jupiter.api.*;
import java.nio.file.*;
import java.io.IOException;
import static org.junit.jupiter.api.Assertions.*;

public class SafeFileWriterTest {
    private static final String TEST_PATH = "unit_test_scores.csv";
    private SafeFileWriter writer;

    @BeforeEach
    void startUp() {
        writer = new SafeFileWriter(TEST_PATH);
    }

    @AfterEach
    void cleanFile() throws IOException {
        Files.deleteIfExists(Paths.get(TEST_PATH));
    }

    @Test
    void testParallelWritingAndFileOutput() throws Exception {
        StudentInfo a = new StudentInfo("Ankit", 501, 80);
        StudentInfo b = new StudentInfo("Rashmi", 502, 90);

        Thread t1 = new ScoreEntryThread(writer, a);
        Thread t2 = new ScoreEntryThread(writer, b);

        t1.start();
        t2.start();

        t1.join();
        t2.join();

        String result = Files.readString(Paths.get(TEST_PATH));

        assertTrue(result.contains("Ankit,501,80"));
        assertTrue(result.contains("Rashmi,502,90"));
    }
}
